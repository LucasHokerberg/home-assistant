# Run wake up routine when an alarm is set or in the morning, and when night mode is on, and vacation mode is off
- id: '0901'
  alias: Routine - Wake up
  trigger:
    - platform: template
      value_template: '{{ as_timestamp(states("sensor.lucas_hokerberg_next_alarm")) == as_timestamp(states("sensor.date_time").replace(",","")) }}'
    - platform: template
      value_template: '{{ as_timestamp(states("sensor.victoria_hjerter_next_alarm")) == as_timestamp(states("sensor.date_time").replace(",","")) }}'
    - platform: time
      at: '08:00:00'
  condition:
    - condition: state
      entity_id: input_boolean.night_mode
      state: 'on'
    - condition: state
      entity_id: input_boolean.vacation_mode
      state: 'off'
  action:
    service: script.wake_up

# Run wake up routine when vacation mode is on
- id: '0904'
  alias: Routine - Wake up vacation
  trigger:
    platform: time
    at: '08:00:00'
  condition:
    condition: state
    entity_id: input_boolean.vacation_mode
    state: 'on'
  action:
    - delay:
        minutes: '{{ range(2,32) | random | int }}'
    - service: script.wake_up
    
# Wake up routine when living room is dark
- id: '0902'
  alias: Routine - Wake up and dark
  trigger:
    platform: state
    entity_id: script.wake_up
    to: 'on'
  condition:
    - condition: numeric_state
      entity_id: sensor.living_room_light_level
      below: 6
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
  action:
    service: homeassistant.turn_on
    entity_id: group.downstairs_window_lights

# Run bedtime routine when the TV is off, it's evening, and all downstairs lights are turned off
- id: '0903'
  alias: Routine - Bedtime
  trigger:
    platform: state
    entity_id: group.downstairs_lights
    to: 'off'
  condition:
    - condition: time
      after: '21:00'
      before: '03:00'
    - condition: state
      entity_id: remote.living_room_harmony_hub
      state: 'off'
    - condition: state
      entity_id: input_boolean.night_mode
      state: 'off'
    - condition: state
      entity_id: input_boolean.guest_mode
      state: 'off'
  action:
    service: script.bedtime

# Run bedtime routine when vacation mode is on
- id: '0905'
  alias: Routine - Bedtime vacation
  trigger:
    platform: time
    at: '21:30:00'
  condition:
    condition: state
    entity_id: input_boolean.vacation_mode
    state: 'on'
  action:
    - delay:
        minutes: '{{ range(16,59) | random | int }}'
    - service: script.bedtime